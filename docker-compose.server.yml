version: '3'

services:

  influx:
    image: influxdb:1.4
    ports:
      - 8086:8086

  mysql:
    image: mysql:5.7.21
    env_file:
      - ./.env
    environment:
      - MYSQL_DATABASE=wordpress

  mysql-mediawiki:
    image: mysql:5.7.21
    env_file:
      - ./.env
    environment:
      - MYSQL_DATABASE=mediawiki

  wordpress:
    image: wordpress:php7.0
    depends_on:
      - mysql
    env_file:
      - ./.env
    environment:
      - VIRTUAL_HOST=wp.codelis.local

  mediawiki:
    image: mediawiki:stable
    depends_on:
      - mysql-mediawiki
    environment:
      - VIRTUAL_HOST=mw.codelis.local
      - MYSQL_DATABASE=mediawiki
      - MYSQL_USER=root
      - MYSQL_PASSWORD=asdfasdf
    # volumes:
    #   - ./mediawiki/LocalSettings.php:/var/www/html/LocalSettings.php

  apache:
    image: httpd:2.4
    environment:
      - VIRTUAL_HOST=visualization.codelis.local
    volumes:
      - ./archive:/usr/local/apache2/htdocs/

  nginx-proxy:
    image: jwilder/nginx-proxy
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock
    ports:
      - 80:80